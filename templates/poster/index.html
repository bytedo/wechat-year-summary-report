<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>{{ group_name }} - å¹´åº¦å›å¿†</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Swiper -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        font-family: "Noto Sans SC", sans-serif;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #0f0f1a;
      }

      .swiper {
        width: 100%;
        height: 100vh;
      }

      .swiper-slide {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px;
        box-sizing: border-box;
        overflow: hidden;
        position: relative;
      }

      /* æ¸å˜èƒŒæ™¯ */
      .bg-gradient-cover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .bg-gradient-stats {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .bg-gradient-users {
        background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
      }

      .bg-gradient-month {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .bg-gradient-quotes {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .bg-gradient-end {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }

      /* SVG èƒŒæ™¯å›¾æ¡ˆ */
      .pattern-dots {
        background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px);
        background-size: 20px 20px;
      }

      .pattern-grid {
        background-image: 
          linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
        background-size: 30px 30px;
      }

      .pattern-circles {
        background-image: radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                          radial-gradient(circle at 80% 20%, rgba(255,255,255,0.08) 0%, transparent 40%),
                          radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 0%, transparent 60%);
      }

      /* æµ®åŠ¨è£…é¥°å…ƒç´  */
      .floating-shapes {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
        pointer-events: none;
      }

      .shape {
        position: absolute;
        border-radius: 50%;
        opacity: 0.1;
        animation: floatShape 8s ease-in-out infinite;
      }

      .shape-1 {
        width: 100px;
        height: 100px;
        background: linear-gradient(45deg, #fff, transparent);
        top: 10%;
        left: 10%;
        animation-delay: 0s;
      }

      .shape-2 {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #fff, transparent);
        top: 70%;
        right: 15%;
        animation-delay: 2s;
      }

      .shape-3 {
        width: 80px;
        height: 80px;
        background: linear-gradient(225deg, #fff, transparent);
        bottom: 20%;
        left: 20%;
        animation-delay: 4s;
      }

      .shape-4 {
        width: 40px;
        height: 40px;
        background: #fff;
        top: 40%;
        right: 10%;
        animation-delay: 1s;
      }

      @keyframes floatShape {
        0%, 100% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
        }
      }

      /* æ³¢æµªèƒŒæ™¯ */
      .wave-container {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 150px;
        overflow: hidden;
        z-index: 0;
      }

      .wave {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 200%;
        height: 100%;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='rgba(255,255,255,0.1)' d='M0,192L48,176C96,160,192,128,288,133.3C384,139,480,181,576,181.3C672,181,768,139,864,128C960,117,1056,139,1152,154.7C1248,171,1344,181,1392,186.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
        background-size: 50% 100%;
        animation: wave 10s linear infinite;
      }

      .wave:nth-child(2) {
        bottom: 10px;
        opacity: 0.5;
        animation-delay: -5s;
        animation-duration: 15s;
      }

      @keyframes wave {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
      }

      /* å‘å…‰æ•ˆæœ */
      .glow-soft {
        box-shadow: 0 0 40px rgba(255,255,255,0.1);
      }

      /* è£…é¥°çº¿æ¡ */
      .decorative-line {
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
        margin: 15px auto;
        border-radius: 2px;
      }

      /* æ°”æ³¡åŠ¨ç”» */
      .bubble {
        position: absolute;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        animation: rise 6s ease-in-out infinite;
      }

      @keyframes rise {
        0% {
          transform: translateY(100vh) scale(0);
          opacity: 0;
        }
        50% {
          opacity: 0.3;
        }
        100% {
          transform: translateY(-100vh) scale(1);
          opacity: 0;
        }
      }

      /* åŠ¨ç”» */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes countUp {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out forwards;
      }

      .animate-fade-in-scale {
        animation: fadeInScale 0.6s ease-out forwards;
      }

      .animate-pulse-slow {
        animation: pulse 3s ease-in-out infinite;
      }

      .animate-float {
        animation: float 4s ease-in-out infinite;
      }

      .delay-100 {
        animation-delay: 0.1s;
      }
      .delay-200 {
        animation-delay: 0.2s;
      }
      .delay-300 {
        animation-delay: 0.3s;
      }
      .delay-400 {
        animation-delay: 0.4s;
      }
      .delay-500 {
        animation-delay: 0.5s;
      }

      /* æ•°å­—æ»šåŠ¨ */
      .number-roll {
        display: inline-block;
        transition: all 0.5s ease-out;
      }

      /* ç²’å­èƒŒæ™¯ */
      .particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
      }

      .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        animation: float 6s ease-in-out infinite;
      }

      /* å¡ç‰‡æ ·å¼ */
      .glass-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      /* éŸ³é¢‘æ§åˆ¶ */
      .audio-control {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .audio-control:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
      }

      .audio-control.playing .music-icon {
        animation: pulse 1s ease-in-out infinite;
      }

      /* è¿›åº¦æŒ‡ç¤ºå™¨ */
      .swiper-pagination-bullet {
        background: rgba(255, 255, 255, 0.5);
        opacity: 1;
      }

      .swiper-pagination-bullet-active {
        background: #fff;
        transform: scale(1.2);
      }

      /* æ»‘åŠ¨æç¤º */
      .swipe-hint {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
        animation: fadeInUp 1s ease-out, float 2s ease-in-out infinite;
        animation-delay: 2s, 3s;
        opacity: 0;
        animation-fill-mode: forwards, none;
      }

      /* å“åº”å¼ */
      @media (max-width: 640px) {
        .text-6xl {
          font-size: 2.5rem;
        }
        .text-5xl {
          font-size: 2rem;
        }
        .text-4xl {
          font-size: 1.75rem;
        }
        .text-3xl {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop preload="auto">
      <source
        src="{{ music_url | default('https://music.163.com/song/media/outer/url?id=1901371647.mp3') }}"
        type="audio/mpeg"
      />
    </audio>

    <!-- éŸ³é¢‘æ§åˆ¶æŒ‰é’® -->
    <div class="audio-control" id="audioControl" onclick="toggleMusic()">
      <span class="music-icon text-white text-xl">ğŸµ</span>
    </div>

    <!-- Swiper å®¹å™¨ -->
    <div class="swiper">
      <div class="swiper-wrapper">
        <!-- å°é¢é¡µ -->
        <div class="swiper-slide bg-gradient-cover pattern-dots">
          <div class="particles" id="particles-cover"></div>
          <!-- æµ®åŠ¨è£…é¥° -->
          <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
            <div class="shape shape-4"></div>
          </div>
          <!-- æ³¢æµªèƒŒæ™¯ -->
          <div class="wave-container">
            <div class="wave"></div>
            <div class="wave"></div>
          </div>
          <div class="text-center z-10">
            <div class="text-6xl mb-6 animate-fade-in-scale">ğŸ‰</div>
            <h1 class="text-5xl font-black text-white mb-4 animate-fade-in-up glow-soft">
              {{ group_name }}
            </h1>
            <div class="decorative-line animate-fade-in-up delay-100"></div>
            <p class="text-2xl text-white/80 mb-8 animate-fade-in-up delay-200">
              {{ year }} å¹´åº¦å›å¿†å½•
            </p>
            <div class="glass-card px-8 py-4 animate-fade-in-up delay-300">
              <p class="text-white/90 text-lg">{{ date_range }}</p>
            </div>
          </div>
          <div class="swipe-hint">ğŸ‘† å‘ä¸Šæ»‘åŠ¨å¼€å§‹å›å¿†</div>
        </div>

        <!-- æ•°æ®æ€»è§ˆé¡µ -->
        <div class="swiper-slide bg-gradient-stats pattern-grid">
          <div class="text-center z-10 w-full max-w-md">
            <h2 class="text-3xl font-bold text-white mb-8 animate-fade-in-up">
              ğŸ“Š è¿™ä¸€å¹´ï¼Œæˆ‘ä»¬...
            </h2>

            <div class="space-y-6">
              <div class="glass-card p-6 animate-fade-in-up delay-100">
                <div
                  class="text-5xl font-black text-white mb-2"
                  data-count="{{ overview.total_messages }}"
                >
                  0
                </div>
                <div class="text-white/80">æ¡æ¶ˆæ¯</div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="glass-card p-4 animate-fade-in-up delay-200">
                  <div
                    class="text-3xl font-bold text-white mb-1"
                    data-count="{{ overview.total_users }}"
                  >
                    0
                  </div>
                  <div class="text-white/70 text-sm">ä½ç¾¤å‹</div>
                </div>
                <div class="glass-card p-4 animate-fade-in-up delay-300">
                  <div
                    class="text-3xl font-bold text-white mb-1"
                    data-count="{{ overview.active_days }}"
                  >
                    0
                  </div>
                  <div class="text-white/70 text-sm">æ´»è·ƒå¤©æ•°</div>
                </div>
              </div>

              <div class="glass-card p-4 animate-fade-in-up delay-400">
                <div class="text-lg text-white/90">
                  å¹³å‡æ¯å¤©
                  <span class="text-2xl font-bold text-yellow-300"
                    >{{ overview.avg_per_day }}</span
                  >
                  æ¡æ¶ˆæ¯
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- å¹´åº¦äººç‰©æ¦œ -->
        <div class="swiper-slide bg-gradient-users">
          <div class="text-center z-10 w-full max-w-md">
            <h2 class="text-3xl font-bold text-white mb-6 animate-fade-in-up">
              ğŸ‘‘ å¹´åº¦è¯ç—¨æ¦œ
            </h2>

            <div class="space-y-3">
              {% for user in rankings.top_talkers[:5] %}
              <div
                class="glass-card p-4 flex items-center animate-fade-in-up delay-{{ loop.index }}00"
              >
                <div
                  class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-white font-bold mr-4"
                >
                  {% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif
                  loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}{% endif %}
                </div>
                <div class="flex-1 text-left">
                  <div class="text-white font-medium">{{ user.user }}</div>
                  <div class="text-white/60 text-sm">
                    {{ user.count }} æ¡ Â· {{ user.percentage }}%
                  </div>
                </div>
                <div class="w-20 bg-white/20 rounded-full h-2">
                  <div
                    class="bg-yellow-400 h-2 rounded-full"
                    style="width: {{ user.percentage * 2 }}%"
                  ></div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- æœˆåº¦å›é¡¾é¡µï¼ˆæ¯æœˆä¸€é¡µï¼‰ -->
        {% for month in monthly_data %}
        <div
          class="swiper-slide bg-gradient-month"
          style="background: linear-gradient(135deg, hsl({{ (month.month_num - 1) * 30 }}, 70%, 50%) 0%, hsl({{ (month.month_num - 1) * 30 + 30 }}, 70%, 60%) 100%);"
        >
          <div class="text-center z-10 w-full max-w-md">
            <div class="text-5xl mb-3 animate-fade-in-scale">ğŸ“…</div>
            <h2 class="text-3xl font-black text-white mb-4 animate-fade-in-up">
              {{ month.month_name }}
            </h2>

            <!-- æ•°æ®ç»Ÿè®¡ -->
            <div class="glass-card p-4 mb-3 animate-fade-in-up delay-100">
              <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                  <div class="text-xl font-bold text-white">{{ month.stats.total_messages }}</div>
                  <div class="text-white/60 text-xs">æ¡æ¶ˆæ¯</div>
                </div>
                <div>
                  <div class="text-xl font-bold text-white">{{ month.stats.active_users }}</div>
                  <div class="text-white/60 text-xs">äººæ´»è·ƒ</div>
                </div>
                <div>
                  <div class="text-xl font-bold text-white">{{ month.stats.active_days }}</div>
                  <div class="text-white/60 text-xs">å¤©æœ‰èŠ</div>
                </div>
              </div>
            </div>

            <!-- è¯é¢˜å›å¿†ï¼ˆAIç”Ÿæˆçš„æè¿°ï¼‰ -->
            {% set memory = topic_memories | selectattr('month_key', 'equalto', month.month) | first %}
            {% if memory %}
            
            <!-- AI æå–çš„å…·ä½“è¯é¢˜ -->
            {% if memory.topics %}
            <div class="glass-card p-3 mb-3 animate-fade-in-up delay-200">
              <div class="text-white/60 text-xs mb-2">ğŸ“Œ æœ¬æœˆçƒ­èŠ</div>
              <div class="space-y-2">
                {% for topic in memory.topics[:3] %}
                <div class="flex items-start text-left">
                  <span class="text-yellow-300 mr-2">â€¢</span>
                  <div>
                    <span class="text-white text-sm font-medium">{{ topic.title }}</span>
                    {% if topic.desc %}
                    <span class="text-white/50 text-xs ml-1">{{ topic.desc }}</span>
                    {% endif %}
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
            {% endif %}
            
            <!-- è¯é¢˜å›å¿†æè¿° -->
            {% if memory.memory %}
            <div class="glass-card p-3 mb-3 animate-fade-in-up delay-250">
              <p class="text-white/80 text-xs leading-relaxed text-left italic">{{ memory.memory }}</p>
            </div>
            {% endif %}
            {% endif %}

            <!-- æœˆåº¦ä¹‹æ˜Ÿå’Œæœ€æ´»è·ƒæ—¥ -->
            <div class="grid grid-cols-2 gap-2 animate-fade-in-up delay-300">
              {% if month.highlights.monthly_star %}
              <div class="glass-card p-3">
                <div class="text-white/60 text-xs mb-1">ğŸ† æœˆåº¦ä¹‹æ˜Ÿ</div>
                <div class="text-white font-bold text-sm truncate">{{ month.highlights.monthly_star.user }}</div>
                <div class="text-yellow-300 text-xs">{{ month.highlights.monthly_star.count }}æ¡</div>
              </div>
              {% endif %}
              {% if month.highlights.busiest_day %}
              <div class="glass-card p-3">
                <div class="text-white/60 text-xs mb-1">ğŸ”¥ æœ€çƒ­ä¸€å¤©</div>
                <div class="text-white font-bold text-sm">{{ month.highlights.busiest_day.date[-5:] }}</div>
                <div class="text-yellow-300 text-xs">{{ month.highlights.busiest_day.count }}æ¡</div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}

        <!-- å¹´åº¦é‡‘å¥é¡µ -->
        <div class="swiper-slide bg-gradient-quotes">
          <div class="text-center z-10 w-full max-w-md overflow-y-auto" style="max-height: 90vh;">
            <h2 class="text-3xl font-bold text-white mb-6 animate-fade-in-up">
              ğŸ’¬ å¹´åº¦é‡‘å¥
            </h2>

            <div class="space-y-3">
              {% for quote in golden_quotes %}
              <div
                class="glass-card p-4 text-left animate-fade-in-up"
                style="animation-delay: {{ loop.index * 0.1 }}s;"
              >
                <div class="flex items-start gap-2 mb-2">
                  {% if quote.category %}
                  <span class="text-sm">
                    {% if 'æç¬‘' in quote.category %}ğŸ˜‚{% elif 'é‡‘ç‰' in quote.category %}ğŸ’¡{% elif 'ååœºé¢' in quote.category %}ğŸ”¥{% elif 'æš–å¿ƒ' in quote.category %}ğŸ’–{% elif 'ç¥å›å¤' in quote.category %}ğŸ­{% else %}ğŸ’¬{% endif %}
                  </span>
                  {% endif %}
                  <div class="text-white text-base">"{{ quote.content }}"</div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-yellow-300 font-medium text-sm"
                    >â€”â€” {{ quote.user }}</span
                  >
                  <span class="text-white/50 text-xs">{{ quote.reason }}</span>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- å¹´åº¦ä¹‹æœ€é¡µ -->
        <div class="swiper-slide bg-gradient-to-br from-purple-600 to-pink-500">
          <div class="text-center z-10 w-full max-w-md">
            <h2 class="text-3xl font-bold text-white mb-6 animate-fade-in-up">
              ğŸ† å¹´åº¦ä¹‹æœ€
            </h2>

            <div class="space-y-4">
              {% for fact in fun_facts %}
              <div
                class="glass-card p-4 flex items-center animate-fade-in-up delay-{{ loop.index }}00"
              >
                <div class="text-3xl mr-4">{{ fact.icon }}</div>
                <div class="text-left flex-1">
                  <div class="text-white/70 text-sm">{{ fact.title }}</div>
                  <div class="text-white font-bold text-xl">
                    {{ fact.value }} {{ fact.unit }}
                  </div>
                  <div class="text-white/60 text-xs">
                    {{ fact.description }}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- ç”¨æˆ·ç”»åƒé¡µï¼ˆæ›¿ä»£è¯äº‘ï¼‰ -->
        <div class="swiper-slide bg-gradient-to-br from-indigo-600 to-purple-500">
          <div class="text-center z-10 w-full max-w-md">
            <h2 class="text-3xl font-bold text-white mb-6 animate-fade-in-up">
              ğŸ‘¤ ç¾¤å‹æ¡£æ¡ˆ
            </h2>

            <div class="space-y-3">
              {% for profile in user_profiles[:6] %}
              <div class="glass-card p-3 flex items-center animate-fade-in-up" style="animation-delay: {{ loop.index * 0.1 }}s;">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center text-white font-bold mr-3 flex-shrink-0">
                  {{ profile.user[:1] }}
                </div>
                <div class="flex-1 text-left min-w-0">
                  <div class="text-white font-medium text-sm truncate">{{ profile.user }}</div>
                  <div class="text-white/60 text-xs">
                    {{ profile.total_messages }}æ¡ Â· æ´»è·ƒ{{ profile.active_days }}å¤© Â· 
                    {% if profile.active_hour >= 22 or profile.active_hour <= 5 %}ğŸŒ™å¤œçŒ«å­{% elif profile.active_hour <= 9 %}â˜€ï¸æ—©èµ·é¸Ÿ{% else %}â˜•å¸¸åœ¨çº¿{% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- æ—©æ™šé¸Ÿé¡µ -->
        <div class="swiper-slide bg-gradient-to-br from-amber-500 to-pink-500">
          <div class="text-center z-10 w-full max-w-md">
            <h2 class="text-3xl font-bold text-white mb-6 animate-fade-in-up">
              â° ä½œæ¯æ¡£æ¡ˆ
            </h2>

            <div class="space-y-4">
              <!-- æ—©èµ·é¸Ÿ -->
              {% if highlights.early_bird and highlights.early_bird.user %}
              <div class="glass-card p-5 animate-fade-in-up delay-100">
                <div class="text-4xl mb-2">â˜€ï¸</div>
                <div class="text-white/70 text-sm">å¹´åº¦æ—©èµ·é¸Ÿ</div>
                <div class="text-white font-bold text-xl">{{ highlights.early_bird.user }}</div>
                <div class="text-yellow-300 text-sm">{{ highlights.early_bird.days }} å¤©ç¬¬ä¸€ä¸ªå‘è¨€</div>
              </div>
              {% endif %}

              <!-- å¤œçŒ«å­ -->
              {% if highlights.night_owl and highlights.night_owl.user %}
              <div class="glass-card p-5 animate-fade-in-up delay-200">
                <div class="text-4xl mb-2">ğŸŒ™</div>
                <div class="text-white/70 text-sm">å¹´åº¦å¤œçŒ«å­</div>
                <div class="text-white font-bold text-xl">{{ highlights.night_owl.user }}</div>
                <div class="text-yellow-300 text-sm">æ·±å¤œå‘è¨€ {{ highlights.night_owl.count }} æ¡</div>
              </div>
              {% endif %}

              <!-- å·…å³°æ—¥ -->
              {% if highlights.peak_day and highlights.peak_day.date %}
              <div class="glass-card p-5 animate-fade-in-up delay-300">
                <div class="text-4xl mb-2">ğŸ‰</div>
                <div class="text-white/70 text-sm">å¹´åº¦æœ€çƒ­ä¸€å¤©</div>
                <div class="text-white font-bold text-xl">{{ highlights.peak_day.date }}</div>
                <div class="text-yellow-300 text-sm">å…¨å¤© {{ highlights.peak_day.count }} æ¡æ¶ˆæ¯</div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- å¹´åº¦å…³é”®è¯é¡µ -->
        <div class="swiper-slide bg-gradient-to-br from-blue-600 to-cyan-400">
          <div class="text-center z-10 w-full max-w-md">
            <h2 class="text-3xl font-bold text-white mb-6 animate-fade-in-up">
              â˜ï¸ å¹´åº¦å…³é”®è¯
            </h2>
            <p class="text-white/60 text-sm mb-6 animate-fade-in-up delay-100">è¿™ä¸€å¹´ï¼Œæˆ‘ä»¬èŠå¾—æœ€å¤šçš„è¯é¢˜</p>

            <div
              class="flex flex-wrap justify-center gap-3 animate-fade-in-scale delay-200"
            >
              {% for word in keywords[:12] %}
              <span
                class="px-4 py-2 rounded-full text-white animate-float"
                style="background: rgba(255,255,255,{{ 0.3 - loop.index * 0.02 }}); font-size: {{ 22 - loop.index * 0.8 }}px; animation-delay: {{ loop.index * 0.15 }}s;"
              >
                {{ word.word }}
              </span>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- ç»“å°¾é¡µ -->
        <div class="swiper-slide bg-gradient-end">
          <div class="particles" id="particles-end"></div>
          <div class="text-center z-10">
            <div class="text-8xl mb-6 animate-pulse-slow">ğŸŠ</div>
            <h2 class="text-4xl font-black text-white mb-4 animate-fade-in-up">
              æ„Ÿè°¢æœ‰ä½ ä»¬
            </h2>
            <p class="text-xl text-white/80 mb-8 animate-fade-in-up delay-200">
              æœŸå¾… {{ year + 1 }} å¹´çš„ç²¾å½©ç»§ç»­
            </p>
            <div
              class="glass-card px-6 py-3 inline-block animate-fade-in-up delay-300"
            >
              <p class="text-white/90">{{ group_name }} Â· {{ year }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆ†é¡µæŒ‡ç¤ºå™¨ -->
      <div class="swiper-pagination"></div>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- GSAP -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/gsap.min.js"></script>

    <script>
      // åˆå§‹åŒ– Swiper
      const swiper = new Swiper(".swiper", {
        direction: "vertical",
        slidesPerView: 1,
        spaceBetween: 0,
        mousewheel: true,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        on: {
          slideChange: function () {
            animateSlide(this.activeIndex);
          },
          init: function () {
            animateSlide(0);
          },
        },
      });

      // é¡µé¢åŠ¨ç”»
      function animateSlide(index) {
        const slide = document.querySelectorAll(".swiper-slide")[index];
        if (!slide) return;

        // é‡ç½®åŠ¨ç”»
        const animatedElements = slide.querySelectorAll('[class*="animate-"]');
        animatedElements.forEach((el) => {
          el.style.opacity = "0";
          void el.offsetWidth; // è§¦å‘ reflow
          el.style.opacity = "";
        });

        // æ•°å­—æ»šåŠ¨åŠ¨ç”»
        const countElements = slide.querySelectorAll("[data-count]");
        countElements.forEach((el) => {
          const target = parseInt(el.dataset.count);
          animateNumber(el, target);
        });
      }

      // æ•°å­—æ»šåŠ¨åŠ¨ç”»
      function animateNumber(element, target) {
        const duration = 1500;
        const start = 0;
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const easeProgress = 1 - Math.pow(1 - progress, 3);
          const current = Math.floor(start + (target - start) * easeProgress);
          element.textContent = current.toLocaleString();

          if (progress < 1) {
            requestAnimationFrame(update);
          }
        }

        requestAnimationFrame(update);
      }

      // èƒŒæ™¯éŸ³ä¹æ§åˆ¶
      const bgMusic = document.getElementById("bgMusic");
      const audioControl = document.getElementById("audioControl");
      let isPlaying = false;

      function toggleMusic() {
        if (isPlaying) {
          bgMusic.pause();
          audioControl.classList.remove("playing");
        } else {
          bgMusic.play().catch((e) => console.log("éŸ³é¢‘æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’"));
          audioControl.classList.add("playing");
        }
        isPlaying = !isPlaying;
      }

      // é¦–æ¬¡äº¤äº’è‡ªåŠ¨æ’­æ”¾
      document.addEventListener(
        "click",
        function initMusic() {
          if (!isPlaying) {
            bgMusic
              .play()
              .then(() => {
                isPlaying = true;
                audioControl.classList.add("playing");
              })
              .catch((e) => console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥"));
          }
          document.removeEventListener("click", initMusic);
        },
        { once: true }
      );

      // åˆ›å»ºç²’å­æ•ˆæœ
      function createParticles(containerId, count = 50) {
        const container = document.getElementById(containerId);
        if (!container) return;

        for (let i = 0; i < count; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.top = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 6 + "s";
          particle.style.opacity = Math.random() * 0.5 + 0.2;
          container.appendChild(particle);
        }
      }

      createParticles("particles-cover");
      createParticles("particles-end");
    </script>
  </body>
</html>
